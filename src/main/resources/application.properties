# ========================================
# APPLICATION BASIC CONFIG
# ========================================
spring.application.name=swosti
server.port=3090
server.servlet.context-path=/

# ========================================
# VIRTUAL THREAD CONFIGURATION
# ========================================
server.tomcat.threads.virtual-enabled=true

# Tomcat threads (virtual threads do NOT need high worker threads)
server.tomcat.threads.max=500
server.tomcat.threads.min-spare=50
server.tomcat.threads.keep-alive-time=30s

# ========================================
# CONNECTION / NETWORK CONFIG
# ========================================
server.tomcat.max-connections=5000
server.tomcat.accept-count=2000
server.tomcat.connection-timeout=20000
server.tomcat.socket.wait-time=120000

# ========================================
# POST/REQUEST SIZE CONFIG
# ========================================
server.tomcat.max-http-form-post-size=2097152
server.tomcat.max-http-request-header-size=8192

# ========================================
# DATABASE CONFIG
# ========================================
spring.datasource.url=jdbc:postgresql://localhost:5432/swosti
spring.datasource.username=evan
spring.datasource.password=evan

spring.jpa.hibernate.ddl-auto=update
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect

# Disable Open-In-View (CRITICAL to prevent DB leaks)
spring.jpa.open-in-view=false

# ========================================
# Hikari Connection Pool (Optimized for PostgreSQL)
# ========================================
spring.datasource.hikari.maximum-pool-size=40
spring.datasource.hikari.minimum-idle=10
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=1800000

# Leak detector (helps find unclosed connections)
spring.datasource.hikari.leak-detection-threshold=30000

# ========================================
# JPA CONFIG
# ========================================
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true

# ========================================
# ASYNC TASK EXECUTION CONFIG
# ========================================
spring.task.execution.pool.core-size=20
spring.task.execution.pool.max-size=200
spring.task.execution.pool.queue-capacity=2000
spring.task.execution.thread-name-prefix=async-vt-

# ========================================
# SCHEDULED TASK CONFIG
# ========================================
spring.task.scheduling.pool.size=20
spring.task.scheduling.thread-name-prefix=scheduled-vt-

# ========================================
# LOGGING CONFIG
# ========================================
logging.level.root=WARN
logging.level.com.icsquiz=INFO
logging.file.name=logs/icsquiz.log

# ========================================
# RabbitMQ CONFIG
# ========================================
spring.rabbitmq.host=localhost
spring.rabbitmq.port=5672
spring.rabbitmq.username=admin
spring.rabbitmq.password=admin

spring.rabbitmq.publisher-confirm-type=correlated
spring.rabbitmq.publisher-returns=true

spring.rabbitmq.listener.simple.retry.enabled=true
spring.rabbitmq.listener.simple.retry.max-attempts=3
spring.rabbitmq.listener.simple.acknowledge-mode=auto

# Disable auto-start (Optional, prevents startup crash)
# spring.rabbitmq.listener.simple.auto-startup=false

# ========================================
# REDIS CONFIG
# ========================================
spring.cache.type=redis
spring.data.redis.host=${VPS_HOST:localhost}
spring.data.redis.port=6379
spring.data.redis.password=${REDIS_PASSWORD:}

